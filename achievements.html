<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è - Testoria</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <div class="logo">
                    <h3>
                         <i class="fas fa-brain"></i>
                          Testoria
                    </h3>
                </div>
                <nav class="nav">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        –ì–ª–∞–≤–Ω–∞—è
                    </a>
                    <a href="catalog.html" class="nav-link">
                        <i class="fas fa-list"></i>
                        –ö–∞—Ç–∞–ª–æ–≥ —Ç–µ—Å—Ç–æ–≤
                    </a>
                    <a href="about.html" class="nav-link">
                        <i class="fas fa-info-circle"></i>
                        –û –Ω–∞—Å
                    </a>
                    <a href="contact.html" class="nav-link">
                        <i class="fas fa-phone"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </a>
                </nav>
                <div class="header-controls">
                    <button class="theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É">
                        <i class="fas fa-moon"></i>
                        <i class="fas fa-sun"></i>
                        <span class="theme-thumb"></span>
                    </button>
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                    <div id="profile-section" class="profile-dropdown">
                        <button class="profile-btn" id="profileBtn">
                            üë§ –ü—Ä–æ—Ñ–∏–ª—å
                        </button>
                        <div class="dropdown-content" id="profileDropdown">
                            <a href="profile.html">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                            <a href="my-tests.html">–ú–æ–∏ —Ç–µ—Å—Ç—ã</a>
                            <a href="achievements.html">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
                            <a href="results.html">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="page-content">
        <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
        <section class="breadcrumbs">
            <div class="container">
                <nav class="breadcrumbs-nav">
                    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    <i class="fas fa-chevron-right"></i>
                    <a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                </nav>
            </div>
        </section>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <section class="page-header">
            <div class="container">
                <div class="page-header-content">
                    <h1 class="page-title">
                        <i class="fas fa-trophy"></i>
                        –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                    </h1>
                    <p class="page-subtitle">–°–æ–±–∏—Ä–∞–π—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–æ–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ —É—Å–ø–µ—Ö–∏!</p>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
                    <div class="achievements-stats">
                        <div class="stat-badge">
                            <div class="stat-number" id="unlockedCount">0</div>
                            <div class="stat-label">–û—Ç–∫—Ä—ã—Ç–æ</div>
                        </div>
                        <div class="stat-badge">
                            <div class="stat-number" id="totalCount">7</div>
                            <div class="stat-label">–í—Å–µ–≥–æ</div>
                        </div>
                        <div class="stat-badge">
                            <div class="stat-number" id="completionRate">0%</div>
                            <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
        <section class="achievements-content">
            <div class="container">
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>
                        <i class="fas fa-brain"></i>
                        Testoria
                    </h3>
                    <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ</p>
                    <div class="social-icons">
                        <a href="#" class="social-link">
                            <i class="fab fa-telegram"></i>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>
                        <i class="fas fa-compass"></i>
                        –ù–∞–≤–∏–≥–∞—Ü–∏—è
                    </h4>
                    <a href="index.html">
                        <i class="fas fa-arrow-right"></i>
                        –ì–ª–∞–≤–Ω–∞—è
                    </a>
                    <a href="catalog.html">
                        <i class="fas fa-arrow-right"></i>
                        –ö–∞—Ç–∞–ª–æ–≥ —Ç–µ—Å—Ç–æ–≤
                    </a>
                    <a href="about.html">
                        <i class="fas fa-arrow-right"></i>
                        –û –Ω–∞—Å
                    </a>
                    <a href="contact.html">
                        <i class="fas fa-arrow-right"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </a>
                </div>
                <div class="footer-section">
                    <h4>
                        <i class="fas fa-envelope"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </h4>
                    <p>
                        <i class="fas fa-envelope"></i>
                        Email: hello@testoria.cloud
                    </p>
                    <p>
                        <i class="fas fa-phone"></i>
                        –¢–µ–ª–µ—Ñ–æ–Ω: +375 (01) 234-56-78
                    </p>
                    <p>
                        <i class="fas fa-map-marker-alt"></i>
                        –ê–¥—Ä–µ—Å: –≥. –ú–∏–Ω—Å–∫, —É–ª. –£—Ä—É—á—Å–∫–∞—è, 81–ë
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>
                    <i class="far fa-copyright"></i>
                    2025 Testoria. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        class AchievementsManager {
            constructor() {
                this.currentUser = null;
                this.userManager = new UserManager();
                this.init();
            }

            init() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
                if (!this.userManager.getCurrentUser()) {
                    window.location.href = 'login.html';
                    return;
                }
                
                this.currentUser = this.userManager.getCurrentUser();
                this.loadAchievements();
                this.setupEventListeners();
            }

            setupEventListeners() {
                // –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è
                document.getElementById('profileBtn')?.addEventListener('click', () => {
                    this.toggleProfileMenu();
                });
            }

            toggleProfileMenu() {
                const dropdown = document.getElementById('profileDropdown');
                if (dropdown.style.display === 'block') {
                    dropdown.style.display = 'none';
                } else {
                    dropdown.style.display = 'block';
                    setTimeout(() => {
                        document.addEventListener('click', this.closeProfileMenu.bind(this), { once: true });
                    }, 0);
                }
            }

            getProgressHint(achievement, progressPercent) {
                if (progressPercent === 0) return '–¢–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...';
                if (progressPercent < 25) return '–ï—Å—Ç—å –∫—É–¥–∞ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è!';
                if (progressPercent < 50) return '–£–∂–µ –Ω–µ–ø–ª–æ—Ö–æ!';
                if (progressPercent < 75) return '–û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å!';
                if (progressPercent < 100) return '–ü–æ—á—Ç–∏ —É —Ü–µ–ª–∏!';
                return '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!';
            }
            
            closeProfileMenu(e) {
                const dropdown = document.getElementById('profileDropdown');
                const profileBtn = document.getElementById('profileBtn');
                if (!dropdown.contains(e.target) && !profileBtn.contains(e.target)) {
                    dropdown.style.display = 'none';
                }
            }

            loadAchievements() {
                const allResults = JSON.parse(localStorage.getItem('testResults')) || [];
                const userResults = allResults.filter(result => result.userId === this.currentUser.id);
                
                // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const stats = this.calculateAdvancedStats(userResults);
                
                const achievements = this.getAchievementsList();
                let unlockedCount = 0;

                const achievementsGrid = document.getElementById('achievementsGrid');
                achievementsGrid.innerHTML = achievements.map(achievement => {
                    const isUnlocked = achievement.condition(stats);
                    const progress = achievement.progress(stats);
                    const progressPercent = Math.min(Math.round(progress * 100), 100);

                    if (isUnlocked) unlockedCount++;

                    return `
                        <div class="achievement-card ${isUnlocked ? 'unlocked' : 'locked'}">
                            <div class="achievement-icon ${isUnlocked ? 'unlocked' : 'locked'}">
                                <i class="${achievement.icon}"></i>
                                ${isUnlocked ? '<div class="achievement-badge">‚úì</div>' : ''}
                            </div>
                            
                            <div class="achievement-content">
                                <h3 class="achievement-title">${achievement.title}</h3>
                                <p class="achievement-description">${achievement.description}</p>
                                
                                <div class="achievement-progress">
                                    <div class="progress-header">
                                        <span class="progress-label">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
                                        <span class="progress-percent">${progressPercent}%</span>
                                    </div>
                                    
                                    <div class="progress-container">
                                        <div class="progress-track">
                                            <div class="progress-fill ${progressPercent === 100 ? 'completed' : ''}" 
                                                style="width: ${progressPercent}%">
                                                ${progressPercent === 100 ? '<div class="progress-sparkle">‚ú®</div>' : ''}
                                            </div>
                                        </div>
                                        
                                        <div class="progress-milestones">
                                            <div class="milestone ${progressPercent >= 25 ? 'reached' : ''}">25%</div>
                                            <div class="milestone ${progressPercent >= 50 ? 'reached' : ''}">50%</div>
                                            <div class="milestone ${progressPercent >= 75 ? 'reached' : ''}">75%</div>
                                            <div class="milestone ${progressPercent >= 100 ? 'reached' : ''}">100%</div>
                                        </div>
                                    </div>
                                    
                                    ${!isUnlocked ? `
                                        <div class="progress-hint">
                                            <i class="fas fa-info-circle"></i>
                                            ${this.getProgressHint(achievement, progressPercent)}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('unlockedCount').textContent = unlockedCount;
                document.getElementById('totalCount').textContent = achievements.length;
                document.getElementById('completionRate').textContent = 
                    Math.round((unlockedCount / achievements.length) * 100) + '%';
            }

            calculateAdvancedStats(userResults) {
                if (userResults.length === 0) {
                    return {
                        testsCompleted: 0,
                        totalTime: 0,
                        totalQuestions: 0,
                        fastestTest: null,
                        dailyStreak: 0,
                        consecutiveDays: 0,
                        earlyBirdCompleted: false,
                        nightOwlCompleted: false,
                        weekendTests: 0,
                        categoriesCompleted: 0
                    };
                }

                // –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const testsCompleted = userResults.length;
                const totalTime = userResults.reduce((total, test) => total + (test.timeSpent || 0), 0);
                const totalQuestions = userResults.reduce((total, test) => total + (test.totalQuestions || 0), 0);
                
                // –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
                const fastestTest = Math.min(...userResults.map(test => test.timeSpent || Infinity));
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
                const uniqueDays = new Set(userResults.map(test => 
                    new Date(test.completedAt).toDateString()
                )).size;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–Ω–Ω–∏–µ —É—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –Ω–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
                const earlyBirdCompleted = userResults.some(test => {
                    const hour = new Date(test.completedAt).getHours();
                    return hour >= 5 && hour < 7;
                });
                
                const nightOwlCompleted = userResults.some(test => {
                    const hour = new Date(test.completedAt).getHours();
                    return hour >= 23 || hour < 5;
                });
                
                // –¢–µ—Å—Ç—ã –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö
                const weekendTests = userResults.filter(test => {
                    const day = new Date(test.completedAt).getDay();
                    return day === 0 || day === 6; // 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6 = —Å—É–±–±–æ—Ç–∞
                }).length;

                return {
                    testsCompleted,
                    totalTime,
                    totalQuestions,
                    fastestTest: fastestTest !== Infinity ? fastestTest : null,
                    dailyStreak: Math.min(uniqueDays, 10), // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–∏–∫–∞
                    consecutiveDays: uniqueDays,
                    earlyBirdCompleted,
                    nightOwlCompleted,
                    weekendTests,
                    categoriesCompleted: Math.min(new Set(userResults.map(test => test.testId)).size, 5)
                };
            }

            getAchievementsList() {
                return [
                    {
                        id: 'first_blood',
                        title: '–ü–µ—Ä–≤–∞—è –∫—Ä–æ–≤—å',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ —Å–≤–æ–π —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç',
                        icon: 'fas fa-tint',
                        condition: (stats) => stats.testsCompleted >= 1,
                        progress: (stats) => Math.min(stats.testsCompleted, 1)
                    },
                    {
                        id: 'test_addict',
                        title: '–ó–∞–≤–∏—Å–∏–º—ã–π',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ 25 —Ç–µ—Å—Ç–æ–≤',
                        icon: 'fas fa-syringe',
                        condition: (stats) => stats.testsCompleted >= 25,
                        progress: (stats) => Math.min(stats.testsCompleted / 25, 1)
                    },
                    {
                        id: 'test_god',
                        title: '–ë–æ–≥ —Ç–µ—Å—Ç–æ–≤',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ 100 —Ç–µ—Å—Ç–æ–≤',
                        icon: 'fas fa-crown',
                        condition: (stats) => stats.testsCompleted >= 100,
                        progress: (stats) => Math.min(stats.testsCompleted / 100, 1)
                    },
                    {
                        id: 'speed_demon',
                        title: '–î–µ–º–æ–Ω —Å–∫–æ—Ä–æ—Å—Ç–∏',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç –∑–∞ 1 –º–∏–Ω—É—Ç—É',
                        icon: 'fas fa-running',
                        condition: (stats) => stats.fastestTest && stats.fastestTest <= 60,
                        progress: (stats) => stats.fastestTest ? Math.max(0, 1 - (stats.fastestTest / 60)) : 0
                    },
                    {
                        id: 'marathon_man',
                        title: '–ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü',
                        description: '–ü–æ—Ç—Ä–∞—Ç—å—Ç–µ 24 —á–∞—Å–∞ –Ω–∞ —Ç–µ—Å—Ç—ã',
                        icon: 'fas fa-infinity',
                        condition: (stats) => stats.totalTime >= 86400,
                        progress: (stats) => Math.min(stats.totalTime / 86400, 1)
                    },
                    {
                        id: 'question_overflow',
                        title: '–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤',
                        description: '–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ 1000 –≤–æ–ø—Ä–æ—Å–æ–≤',
                        icon: 'fas fa-brain',
                        condition: (stats) => stats.totalQuestions >= 1000,
                        progress: (stats) => Math.min(stats.totalQuestions / 1000, 1)
                    },
                    {
                        id: 'perfectionist',
                        title: '–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ 10 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å',
                        icon: 'fas fa-star',
                        condition: (stats) => stats.dailyStreak >= 10,
                        progress: (stats) => Math.min((stats.dailyStreak || 0) / 10, 1)
                    },
                    {
                        id: 'no_life',
                        title: '–ë–µ–∑ –∂–∏–∑–Ω–∏',
                        description: '–ü—Ä–æ–≤–µ–¥–∏—Ç–µ 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –≤ —Ç–µ—Å—Ç–∞—Ö',
                        icon: 'fas fa-moon',
                        condition: (stats) => stats.consecutiveDays >= 7,
                        progress: (stats) => Math.min((stats.consecutiveDays || 0) / 7, 1)
                    },
                    {
                        id: 'category_conqueror',
                        title: '–ü–æ–∫–æ—Ä–∏—Ç–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π',
                        description: '–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç—ã –∏–∑ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π',
                        icon: 'fas fa-flag',
                        condition: (stats) => stats.categoriesCompleted >= 5,
                        progress: (stats) => Math.min((stats.categoriesCompleted || 0) / 5, 1)
                    }
                ];
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            new AchievementsManager();
        });
    </script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="auth-core.js"></script>
    <script src="auth-header.js"></script>
</body>
</html>