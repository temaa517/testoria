<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏ - Testoria</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .tests-management {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: var(--shadow);
        }

        .tests-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted-text);
        }

        .tests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }

        .test-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .test-title {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .test-description {
            color: var(--muted-text);
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .test-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .test-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8em;
            color: var(--muted-text);
        }

        .test-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: var(--card-bg);
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close {
            font-size: 1.5em;
            cursor: pointer;
            color: var(--muted-text);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .questions-list {
            margin: 20px 0;
        }

        .question-item {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .question-text {
            font-weight: 500;
            margin-bottom: 10px;
        }

        .answers-list {
            margin-left: 20px;
        }

        .answer-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding: 5px;
        }

        .answer-item.correct {
            background: rgba(40, 167, 69, 0.1);
            border-radius: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--muted-text);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .create-test-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .create-test-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <div class="logo">
                    <h3>
                        <i class="fas fa-brain"></i>
                        Testoria
                    </h3>
                </div>
                <nav class="nav">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        –ì–ª–∞–≤–Ω–∞—è
                    </a>
                    <a href="catalog.html" class="nav-link">
                        <i class="fas fa-list"></i>
                        –ö–∞—Ç–∞–ª–æ–≥ —Ç–µ—Å—Ç–æ–≤
                    </a>
                    <a href="about.html" class="nav-link">
                        <i class="fas fa-info-circle"></i>
                        –û –Ω–∞—Å
                    </a>
                    <a href="contact.html" class="nav-link">
                        <i class="fas fa-phone"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </a>
                    <a href="admin.html" class="nav-link">
                        <i class="fas fa-crown"></i>
                        –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                    </a>
                </nav>
                <div class="header-controls">
                    <button class="theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É">
                        <i class="fas fa-moon"></i>
                        <i class="fas fa-sun"></i>
                        <span class="theme-thumb"></span>
                    </button>
                    <div id="profile-section" class="profile-dropdown">
                        <button class="profile-btn" id="profileBtn">
                            üë§ –ü—Ä–æ—Ñ–∏–ª—å
                        </button>
                        <div class="dropdown-content" id="profileDropdown">
                            <a href="profile.html">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                            <a href="my-tests.html">–ú–æ–∏ —Ç–µ—Å—Ç—ã</a>
                            <a href="achievements.html">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
                            <a href="results.html">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="page-content">
        <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
        <section class="breadcrumbs">
            <div class="container">
                <nav class="breadcrumbs-nav">
                    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    <i class="fas fa-chevron-right"></i>
                    <a href="admin.html">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏</span>
                </nav>
            </div>
        </section>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <section class="page-header">
            <div class="container">
                <div class="page-header-content">
                    <a href="admin.html" class="back-button">
                        <i class="fas fa-arrow-left"></i>
                        –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                    </a>
                    <h1 class="page-title">
                        <i class="fas fa-edit"></i>
                        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏
                    </h1>
                    <p class="page-subtitle">–°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</p>
                </div>
            </div>
        </section>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <section class="admin-content">
            <div class="container">
                <div class="tests-management">
                    <div class="tests-header">
                        <h2>
                            <i class="fas fa-list"></i>
                            –í—Å–µ —Ç–µ—Å—Ç—ã
                        </h2>
                        <div class="search-box">
                            <input type="text" id="testSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–æ–≤...">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="create-test-btn" onclick="openCreateTestModal()">
                            <i class="fas fa-plus"></i>
                            –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç
                        </button>
                    </div>

                    <div class="tests-grid" id="testsGrid">
                        <!-- –¢–µ—Å—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ -->
    <div id="editTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="editTestTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</h3>
                <span class="close" onclick="closeEditTestModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</label>
                    <input type="text" id="editTestName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞">
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="editTestDescription" class="form-control" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ (–º–∏–Ω—É—Ç)</label>
                    <input type="number" id="editTestTimeLimit" class="form-control" placeholder="0 –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏">
                </div>
                
                <h4>–í–æ–ø—Ä–æ—Å—ã</h4>
                <div class="questions-list" id="editQuestionsList">
                    <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
                
                <button class="btn-sm btn-success" onclick="addNewQuestion()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn-sm btn-danger" onclick="closeEditTestModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-sm btn-primary" onclick="saveTestChanges()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ -->
    <div id="createTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞</h3>
                <span class="close" onclick="closeCreateTestModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</label>
                    <input type="text" id="createTestName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞">
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="createTestDescription" class="form-control" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ (–º–∏–Ω—É—Ç)</label>
                    <input type="number" id="createTestTimeLimit" class="form-control" value="10">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-sm btn-danger" onclick="closeCreateTestModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-sm btn-success" onclick="createNewTest()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç</button>
            </div>
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>
                        <i class="fas fa-brain"></i>
                        Testoria
                    </h3>
                    <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ</p>
                    <div class="social-icons">
                        <a href="https://t.me/ttemkatut" class="social-link">
                            <i class="fab fa-telegram"></i>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>
                        <i class="fas fa-compass"></i>
                        –ù–∞–≤–∏–≥–∞—Ü–∏—è
                    </h4>
                    <a href="index.html">
                        <i class="fas fa-arrow-right"></i>
                        –ì–ª–∞–≤–Ω–∞—è
                    </a>
                    <a href="catalog.html">
                        <i class="fas fa-arrow-right"></i>
                        –ö–∞—Ç–∞–ª–æ–≥ —Ç–µ—Å—Ç–æ–≤
                    </a>
                    <a href="about.html">
                        <i class="fas fa-arrow-right"></i>
                        –û –Ω–∞—Å
                    </a>
                    <a href="contact.html">
                        <i class="fas fa-arrow-right"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </a>
                </div>
                <div class="footer-section">
                    <h4>
                        <i class="fas fa-envelope"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </h4>
                    <p>
                        <i class="fas fa-envelope"></i>
                        Email: hello@testoria.cloud
                    </p>
                    <p>
                        <i class="fas fa-phone"></i>
                        –¢–µ–ª–µ—Ñ–æ–Ω: +375 (01) 234-56-78
                    </p>
                    <p>
                        <i class="fas fa-map-marker-alt"></i>
                        –ê–¥—Ä–µ—Å: –≥. –ú–∏–Ω—Å–∫, —É–ª. –£—Ä—É—á—Å–∫–∞—è, 81–ë
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>
                    <i class="far fa-copyright"></i>
                    2025 Testoria. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
                </p>
            </div>
        </div>
    </footer>
<script>// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
class TestsManager {
    constructor() {
        this.userManager = new UserManager();
        this.tests = [];
        this.currentEditingTest = null;
        this.init();
    }

    init() {
        console.log('üìù –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–∞–º–∏...');
        
        if (!this.checkAdminAccess()) {
            return;
        }

        this.loadTests();
        this.setupEventListeners();
    }

    checkAdminAccess() {
        const user = this.userManager.getCurrentUser();
        
        if (!user) {
            window.location.href = 'login.html';
            return false;
        }

        if (!this.userManager.isAdmin(user)) {
            this.showAccessDenied();
            return false;
        }

        return true;
    }

    showAccessDenied() {
        document.querySelector('main').innerHTML = `
            <div class="container">
                <div class="access-denied">
                    <i class="fas fa-lock"></i>
                    <h2>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
                    <p>–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</p>
                    <a href="index.html" class="btn btn-primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
                </div>
            </div>
        `;
    }

    loadTests() {
        console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤...');
        
        // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤
        this.tests = this.getTestsFromStorage();
        console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤:', this.tests.length);
        
        this.renderTestsGrid();
    }

    getTestsFromStorage() {
        // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
        const sources = [
            localStorage.getItem('testsData'),
            localStorage.getItem('allTests'),
            localStorage.getItem('testoria_tests')
        ];

        for (let source of sources) {
            if (source) {
                try {
                    const tests = JSON.parse(source);
                    if (Array.isArray(tests) || typeof tests === 'object') {
                        console.log('‚úÖ –¢–µ—Å—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage');
                        return this.normalizeTests(tests);
                    }
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ—Å—Ç–æ–≤:', e);
                }
            }
        }

        // –ï—Å–ª–∏ —Ç–µ—Å—Ç–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–¥–∏–º –¥–µ–º–æ-—Ç–µ—Å—Ç—ã
        console.log('‚ùå –¢–µ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —Å–æ–∑–¥–∞–µ–º –¥–µ–º–æ-—Ç–µ—Å—Ç—ã');
        return this.createDemoTests();
    }

    normalizeTests(tests) {
        if (Array.isArray(tests)) {
            return tests;
        } else if (typeof tests === 'object') {
            return Object.values(tests);
        }
        return [];
    }

        createDemoTests() {
        const demoTests = [
            {
                id: '1',
                title: '–¢–µ—Å—Ç –ø–æ JavaScript',
                description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π –æ—Å–Ω–æ–≤ JavaScript',
                timeLimit: 10,
                questions: [
                    {
                        id: 1,
                        text: '–ß—Ç–æ —Ç–∞–∫–æ–µ –∑–∞–º—ã–∫–∞–Ω–∏–µ (closure) –≤ JavaScript?',
                        answers: [
                            { text: '–°–ø–æ—Å–æ–± –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π', correct: false },
                            { text: '–§—É–Ω–∫—Ü–∏—è –≤–º–µ—Å—Ç–µ —Å –ª–µ–∫—Å–∏—á–µ—Å–∫–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º', correct: true },
                            { text: '–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –º–∞—Å—Å–∏–≤–∞', correct: false },
                            { text: '–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö', correct: false }
                        ]
                    },
                    {
                        id: 2,
                        text: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –≤ –∫–æ–Ω–µ—Ü –º–∞—Å—Å–∏–≤–∞?',
                        answers: [
                            { text: 'push()', correct: true },
                            { text: 'pop()', correct: false },
                            { text: 'shift()', correct: false },
                            { text: 'unshift()', correct: false }
                        ]
                    }
                ]
            },
            {
                id: '2', 
                title: '–¢–µ—Å—Ç –ø–æ HTML/CSS',
                description: '–û—Å–Ω–æ–≤—ã –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏',
                timeLimit: 15,
                questions: [
                    {
                        id: 1,
                        text: '–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç HTML?',
                        answers: [
                            { text: 'Hyper Text Markup Language', correct: true },
                            { text: 'High Tech Modern Language', correct: false },
                            { text: 'Hyper Transfer Markup Language', correct: false }
                        ]
                    }
                ]
            }
        ];

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ–º–æ-—Ç–µ—Å—Ç—ã
        localStorage.setItem('testoria_tests', JSON.stringify(demoTests));
        return demoTests;
    }

    renderTestsGrid() {
        const grid = document.getElementById('testsGrid');
        
        if (this.tests.length === 0) {
            grid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-tasks"></i>
                    <h3>–¢–µ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</p>
                    <button class="create-test-btn" onclick="openCreateTestModal()">
                        <i class="fas fa-plus"></i>
                        –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç
                    </button>
                </div>
            `;
            return;
        }

        grid.innerHTML = this.tests.map(test => `
            <div class="test-card" onclick="testsManager.editTest('${test.id}')">
                <div class="test-card-header">
                    <div>
                        <div class="test-title">${this.escapeHtml(test.title)}</div>
                        <div class="test-description">${this.escapeHtml(test.description)}</div>
                    </div>
                </div>
                <div class="test-meta">
                    <div class="test-meta-item">
                        <i class="fas fa-question-circle"></i>
                        ${test.questions ? test.questions.length : 0} –≤–æ–ø—Ä–æ—Å–æ–≤
                    </div>
                    <div class="test-meta-item">
                        <i class="fas fa-clock"></i>
                        ${test.timeLimit || '–ë–µ–∑'} –º–∏–Ω.
                    </div>
                </div>
                <div class="test-actions">
                    <button class="btn-sm btn-primary" onclick="event.stopPropagation(); testsManager.editTest('${test.id}')">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn-sm btn-danger" onclick="event.stopPropagation(); testsManager.deleteTest('${test.id}')">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
        `).join('');
    }

    editTest(testId) {
        const test = this.tests.find(t => t.id === testId);
        if (!test) {
            alert('–¢–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        this.currentEditingTest = test;
        this.openEditTestModal(test);
    }

    openEditTestModal(test) {
        document.getElementById('editTestTitle').textContent = `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${test.title}`;
        document.getElementById('editTestName').value = test.title;
        document.getElementById('editTestDescription').value = test.description || '';
        document.getElementById('editTestTimeLimit').value = test.timeLimit || '';
        
        this.renderQuestionsList(test.questions || []);
        document.getElementById('editTestModal').style.display = 'block';
    }

    renderQuestionsList(questions) {
        const container = document.getElementById('editQuestionsList');
        
        if (questions.length === 0) {
            container.innerHTML = '<p>–í —ç—Ç–æ–º —Ç–µ—Å—Ç–µ –ø–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</p>';
            return;
        }

        container.innerHTML = questions.map((question, qIndex) => `
            <div class="question-item">
                <div class="question-header">
                    <strong>–í–æ–ø—Ä–æ—Å ${qIndex + 1}</strong>
                    <button class="btn-sm btn-danger" onclick="testsManager.deleteQuestion(${qIndex})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="question-text">${this.escapeHtml(question.text)}</div>
                <div class="answers-list">
                    ${(question.answers || []).map((answer, aIndex) => `
                        <div class="answer-item ${answer.correct ? 'correct' : ''}">
                            <input type="radio" name="correct-${qIndex}" 
                                   ${answer.correct ? 'checked' : ''} 
                                   onchange="testsManager.setCorrectAnswer(${qIndex}, ${aIndex})">
                            <input type="text" class="form-control" value="${this.escapeHtml(answer.text)}"
                                   onchange="testsManager.updateAnswerText(${qIndex}, ${aIndex}, this.value)">
                            <button class="btn-sm btn-danger" onclick="testsManager.deleteAnswer(${qIndex}, ${aIndex})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `).join('')}
                </div>
                <button class="btn-sm btn-success" onclick="testsManager.addAnswer(${qIndex})">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
                </button>
            </div>
        `).join('');
    }

    addNewQuestion() {
        if (!this.currentEditingTest) return;
        
        if (!this.currentEditingTest.questions) {
            this.currentEditingTest.questions = [];
        }
        
        const newQuestion = {
            id: Date.now(),
            text: '–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å',
            answers: [
                { text: '–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç', correct: true },
                { text: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç', correct: false }
            ]
        };
        
        this.currentEditingTest.questions.push(newQuestion);
        this.renderQuestionsList(this.currentEditingTest.questions);
    }

    deleteQuestion(questionIndex) {
        if (!this.currentEditingTest || !confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?')) return;
        
        this.currentEditingTest.questions.splice(questionIndex, 1);
        this.renderQuestionsList(this.currentEditingTest.questions);
    }

    addAnswer(questionIndex) {
        if (!this.currentEditingTest) return;
        
        this.currentEditingTest.questions[questionIndex].answers.push({
            text: '–ù–æ–≤—ã–π –æ—Ç–≤–µ—Ç',
            correct: false
        });
        
        this.renderQuestionsList(this.currentEditingTest.questions);
    }

    deleteAnswer(questionIndex, answerIndex) {
        if (!this.currentEditingTest || !confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç?')) return;
        
        const answers = this.currentEditingTest.questions[questionIndex].answers;
        if (answers.length <= 2) {
            alert('–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 –æ—Ç–≤–µ—Ç–∞');
            return;
        }
        
        answers.splice(answerIndex, 1);
        this.renderQuestionsList(this.currentEditingTest.questions);
    }

    setCorrectAnswer(questionIndex, answerIndex) {
        if (!this.currentEditingTest) return;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ correct –Ω–∞ false
        this.currentEditingTest.questions[questionIndex].answers.forEach((answer, index) => {
            answer.correct = (index === answerIndex);
        });
        
        this.renderQuestionsList(this.currentEditingTest.questions);
    }

    updateAnswerText(questionIndex, answerIndex, newText) {
        if (!this.currentEditingTest) return;
        
        this.currentEditingTest.questions[questionIndex].answers[answerIndex].text = newText;
    }

    saveTestChanges() {
        if (!this.currentEditingTest) return;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞
        this.currentEditingTest.title = document.getElementById('editTestName').value;
        this.currentEditingTest.description = document.getElementById('editTestDescription').value;
        this.currentEditingTest.timeLimit = parseInt(document.getElementById('editTestTimeLimit').value) || 0;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        this.saveTestsToStorage();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        this.renderTestsGrid();
        this.closeEditTestModal();
        
        alert('‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    }

    deleteTest(testId) {
        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ—Å—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
            return;
        }
        
        this.tests = this.tests.filter(test => test.id !== testId);
        this.saveTestsToStorage();
        this.renderTestsGrid();
        
        alert('‚úÖ –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω!');
    }

    saveTestsToStorage() {
        localStorage.setItem('testoria_tests', JSON.stringify(this.tests));
    }

    setupEventListeners() {
        // –ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–æ–≤
        const searchInput = document.getElementById('testSearch');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.filterTests(e.target.value);
            });
        }

        // –ú–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è
        document.getElementById('profileBtn')?.addEventListener('click', () => {
            this.toggleProfileMenu();
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.addEventListener('click', (e) => {
            const editModal = document.getElementById('editTestModal');
            const createModal = document.getElementById('createTestModal');
            
            if (e.target === editModal) {
                this.closeEditTestModal();
            }
            if (e.target === createModal) {
                this.closeCreateTestModal();
            }
        });
    }

    filterTests(searchTerm) {
        if (!searchTerm) {
            this.renderTestsGrid();
            return;
        }

        const filteredTests = this.tests.filter(test => 
            test.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
            test.description.toLowerCase().includes(searchTerm.toLowerCase())
        );

        const grid = document.getElementById('testsGrid');
        grid.innerHTML = filteredTests.map(test => `
            <div class="test-card" onclick="testsManager.editTest('${test.id}')">
                <div class="test-card-header">
                    <div>
                        <div class="test-title">${this.escapeHtml(test.title)}</div>
                        <div class="test-description">${this.escapeHtml(test.description)}</div>
                    </div>
                </div>
                <div class="test-meta">
                    <div class="test-meta-item">
                        <i class="fas fa-question-circle"></i>
                        ${test.questions ? test.questions.length : 0} –≤–æ–ø—Ä–æ—Å–æ–≤
                    </div>
                    <div class="test-meta-item">
                        <i class="fas fa-clock"></i>
                        ${test.timeLimit || '–ë–µ–∑'} –º–∏–Ω.
                    </div>
                </div>
                <div class="test-actions">
                    <button class="btn-sm btn-primary" onclick="event.stopPropagation(); testsManager.editTest('${test.id}')">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn-sm btn-danger" onclick="event.stopPropagation(); testsManager.deleteTest('${test.id}')">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
        `).join('');
    }

    closeEditTestModal() {
        document.getElementById('editTestModal').style.display = 'none';
        this.currentEditingTest = null;
    }

    closeCreateTestModal() {
        document.getElementById('createTestModal').style.display = 'none';
    }

    createNewTest() {
        const name = document.getElementById('createTestName').value;
        const description = document.getElementById('createTestDescription').value;
        const timeLimit = parseInt(document.getElementById('createTestTimeLimit').value) || 0;

        if (!name) {
            alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞');
            return;
        }

        const newTest = {
            id: Date.now().toString(),
            title: name,
            description: description,
            timeLimit: timeLimit,
            questions: []
        };

        this.tests.push(newTest);
        this.saveTestsToStorage();
        this.renderTestsGrid();
        this.closeCreateTestModal();
        
        alert('‚úÖ –ù–æ–≤—ã–π —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã.');
    }

    toggleProfileMenu() {
        const dropdown = document.getElementById('profileDropdown');
        if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
        } else {
            dropdown.style.display = 'block';
            setTimeout(() => {
                document.addEventListener('click', this.closeProfileMenu.bind(this), { once: true });
            }, 0);
        }
    }

    closeProfileMenu(e) {
        const dropdown = document.getElementById('profileDropdown');
        const profileBtn = document.getElementById('profileBtn');
        if (!dropdown.contains(e.target) && !profileBtn.contains(e.target)) {
            dropdown.style.display = 'none';
        }
    }

    escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
}

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ HTML
    function openCreateTestModal() {
        document.getElementById('createTestModal').style.display = 'block';
    }

    function closeCreateTestModal() {
        document.getElementById('createTestModal').style.display = 'none';
    }

    function addNewQuestion() {
        if (window.testsManager) {
            window.testsManager.addNewQuestion();
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
        window.testsManager = new TestsManager();
    });

    </script>
    <!-- JavaScript -->
    <script src="auth-core.js"></script>
    <script src="auth-header.js"></script>

</body>
</html>