<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å - Testoria</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <div class="logo">
                    <h3>
                        <a href="index.html">
                            <i class="fas fa-brain"></i>
                            Testoria
                        </a>
                    </h3>
                </div>
                <nav class="nav">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        –ì–ª–∞–≤–Ω–∞—è
                    </a>
                    <a href="catalog.html" class="nav-link">
                        <i class="fas fa-list"></i>
                        –ö–∞—Ç–∞–ª–æ–≥ —Ç–µ—Å—Ç–æ–≤
                    </a>
                    <a href="about.html" class="nav-link">
                        <i class="fas fa-info-circle"></i>
                        –û –Ω–∞—Å
                    </a>
                    <a href="contact.html" class="nav-link">
                        <i class="fas fa-phone"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </a>
                </nav>
                <div class="header-controls">
                    <button class="theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É">
                        <i class="fas fa-moon"></i>
                        <i class="fas fa-sun"></i>
                        <span class="theme-thumb"></span>
                    </button>
                    <!-- –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
                    <div id="auth-buttons" class="auth-buttons">
                        <a href="login.html" class="btn btn-outline">–í–æ–π—Ç–∏</a>
                        <a href="register.html" class="btn btn-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
                    <div id="profile-section" class="profile-dropdown" style="display: none;">
                        <button class="profile-btn" onclick="toggleProfileMenu()">
                            üë§ –ü—Ä–æ—Ñ–∏–ª—å
                        </button>
                        <div class="dropdown-content">
                            <a href="profile.html">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                            <a href="my-tests.html">–ú–æ–∏ —Ç–µ—Å—Ç—ã</a>
                            <a href="results.html">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
                            <a href="#" onclick="logout()">–í—ã–π—Ç–∏</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="page-content">
        <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
        <section class="breadcrumbs">
            <div class="container">
                <nav class="breadcrumbs-nav">
                    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</span>
                </nav>
            </div>
        </section>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <section class="profile-header">
            <div class="container">
                <div class="profile-header-content">
                    <h1 class="page-title">
                        <i class="fas fa-user-circle"></i>
                        –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
                    </h1>
                    <p class="page-subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
                </div>
            </div>
        </section>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è -->
        <section class="profile-content">
            <div class="container">
                <div class="profile-grid">
                    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                    <div class="profile-sidebar">
                        <div class="user-card">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <h3 id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                            <p class="user-join-date" id="userJoinDate">–£—á–∞—Å—Ç–Ω–∏–∫ —Å ...</p>
                            <button class="btn btn-secondary btn-full" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                –í—ã–π—Ç–∏
                            </button>
                        </div>

                        <div class="profile-nav">
                            <button class="nav-btn active" data-tab="stats">
                                <i class="fas fa-chart-bar"></i>
                                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                            </button>
                            <button class="nav-btn" data-tab="history">
                                <i class="fas fa-history"></i>
                                –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤
                            </button>
                            <button class="nav-btn" data-tab="settings">
                                <i class="fas fa-cog"></i>
                                –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </div>
                    </div>

                    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
                    <div class="profile-main">
                        <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                        <div class="tab-content active" id="stats-tab">
                            <h2>
                                <i class="fas fa-chart-line"></i>
                                –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                            </h2>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="testsCompleted">0</span>
                                        <span class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="totalTime">0—á</span>
                                        <span class="stat-label">–û–±—â–µ–µ –≤—Ä–µ–º—è</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="achievementsCount">0</span>
                                        <span class="stat-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                                    </div>
                                </div>
                            </div>

                            <div class="recent-activity">
                                <h3>–ù–µ–¥–∞–≤–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                                <div class="activity-list" id="recentActivity">
                                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- –í–∫–ª–∞–¥–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ -->
                        <div class="tab-content" id="history-tab">
                            <h2>
                                <i class="fas fa-history"></i>
                                –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤
                            </h2>
                            <div class="history-list" id="historyList">
                                <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                            </div>
                        </div>

                        <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                        <div class="tab-content" id="settings-tab">
                            <h2>
                                <i class="fas fa-cog"></i>
                                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
                            </h2>
                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="userNameInput">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                                    <input type="text" id="userNameInput" class="form-control">
                                </div>
                                <button class="btn btn-primary" onclick="updateUserName()">
                                    <i class="fas fa-save"></i>
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>
                        <i class="fas fa-brain"></i>
                        Testoria
                    </h3>
                    <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ</p>
                    <div class="social-icons">
                        <a href="#" class="social-link">
                            <i class="fab fa-telegram"></i>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>
                        <i class="fas fa-compass"></i>
                        –ù–∞–≤–∏–≥–∞—Ü–∏—è
                    </h4>
                    <a href="index.html">
                        <i class="fas fa-arrow-right"></i>
                        –ì–ª–∞–≤–Ω–∞—è
                    </a>
                    <a href="catalog.html">
                        <i class="fas fa-arrow-right"></i>
                        –ö–∞—Ç–∞–ª–æ–≥ —Ç–µ—Å—Ç–æ–≤
                    </a>
                    <a href="about.html">
                        <i class="fas fa-arrow-right"></i>
                        –û –Ω–∞—Å
                    </a>
                    <a href="contact.html">
                        <i class="fas fa-arrow-right"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </a>
                </div>
                <div class="footer-section">
                    <h4>
                        <i class="fas fa-envelope"></i>
                        –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </h4>
                    <p>
                        <i class="fas fa-envelope"></i>
                        Email: hello@testoria.cloud
                    </p>
                    <p>
                        <i class="fas fa-phone"></i>
                        –¢–µ–ª–µ—Ñ–æ–Ω: +375 (01) 234-56-78
                    </p>
                    <p>
                        <i class="fas fa-map-marker-alt"></i>
                        –ê–¥—Ä–µ—Å: –≥. –ú–∏–Ω—Å–∫, —É–ª. –£—Ä—É—á—Å–∫–∞—è, 81–ë
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>
                    <i class="far fa-copyright"></i>
                    2025 Testoria. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Profile Manager
        class ProfileManager {
            constructor() {
                this.userManager = new UserManager();
                this.currentUser = null;
                this.init();
            }

            init() {
                this.checkAuth();
                this.setupEventListeners();
                this.loadProfileData();
            }

            checkAuth() {
                if (!this.userManager.isLoggedIn()) {
                    window.location.href = 'login.html';
                    return;
                }
                this.currentUser = this.userManager.getCurrentUser();
                this.updateAuthButtons();
            }

            updateAuthButtons() {
                const authButtons = document.getElementById('authButtons');
                if (this.currentUser) {
                    authButtons.innerHTML = `
                        <a href="profile.html" class="btn btn-user">
                            <i class="fas fa-user"></i>
                            ${this.currentUser.name}
                        </a>
                    `;
                }
            }

            setupEventListeners() {
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tab = btn.dataset.tab;
                        this.switchTab(tab);
                    });
                });
            }

            switchTab(tabName) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.add('active');
            }

            loadProfileData() {
                if (!this.currentUser) return;

                // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                document.getElementById('userName').textContent = this.currentUser.name;
                document.getElementById('userNameInput').value = this.currentUser.name;
                
                // –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                const joinDate = new Date(this.currentUser.createdAt).toLocaleDateString('ru-RU');
                document.getElementById('userJoinDate').textContent = `–£—á–∞—Å—Ç–Ω–∏–∫ —Å ${joinDate}`;

                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                document.getElementById('testsCompleted').textContent = this.currentUser.stats.testsCompleted;
                document.getElementById('totalTime').textContent = this.formatTime(this.currentUser.stats.totalTime);
                document.getElementById('achievementsCount').textContent = this.currentUser.achievements.length;

                // –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤
                this.loadHistory();
                this.loadRecentActivity();
            }

            loadHistory() {
                const historyList = document.getElementById('historyList');
                if (this.currentUser.history.length === 0) {
                    historyList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <h3>–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤ –ø—É—Å—Ç–∞</h3>
                            <p>–ü—Ä–æ–π–¥–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –∑–¥–µ—Å—å!</p>
                            <a href="catalog.html" class="btn btn-primary">–ù–∞–π—Ç–∏ —Ç–µ—Å—Ç</a>
                        </div>
                    `;
                    return;
                }

                historyList.innerHTML = this.currentUser.history.map(test => `
                    <div class="history-item">
                        <div class="test-info">
                            <h4>${test.testTitle}</h4>
                            <p>${test.result.title}</p>
                        </div>
                        <div class="test-meta">
                            <span class="test-date">${new Date(test.completedAt).toLocaleDateString('ru-RU')}</span>
                            <span class="test-time">${this.formatTime(test.timeSpent)}</span>
                        </div>
                    </div>
                `).join('');
            }

            loadRecentActivity() {
                const activityList = document.getElementById('recentActivity');
                const recentTests = this.currentUser.history.slice(0, 5);
                
                if (recentTests.length === 0) {
                    activityList.innerHTML = '<p class="no-activity">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>';
                    return;
                }

                activityList.innerHTML = recentTests.map(test => `
                    <div class="activity-item">
                        <i class="fas fa-check-circle"></i>
                        <div class="activity-content">
                            <span class="activity-text">–ü—Ä–æ–π–¥–µ–Ω —Ç–µ—Å—Ç "${test.testTitle}"</span>
                            <span class="activity-time">${this.formatRelativeTime(test.completedAt)}</span>
                        </div>
                    </div>
                `).join('');
            }

            formatTime(minutes) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return hours > 0 ? `${hours}—á ${mins}–º` : `${mins}–º`;
            }

            formatRelativeTime(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const diffDays = Math.floor(diffHours / 24);

                if (diffMins < 1) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
                if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                if (diffHours < 24) return `${diffHours} —á –Ω–∞–∑–∞–¥`;
                if (diffDays < 7) return `${diffDays} –¥ –Ω–∞–∑–∞–¥`;
                return date.toLocaleDateString('ru-RU');
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function logout() {
            const userManager = new UserManager();
            userManager.logout();
            window.location.href = 'index.html';
        }

        function updateUserName() {
            const newName = document.getElementById('userNameInput').value.trim();
            if (!newName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            const userManager = new UserManager();
            try {
                userManager.updateUserName(newName);
                location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            } catch (error) {
                alert(error.message);
            }
        }

        // ThemeManager (—Ç–∞–∫–æ–π –∂–µ –∫–∞–∫ –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö)
        class ThemeManager {
            constructor() {
                this.themeToggle = document.getElementById('themeToggle');
                this.htmlElement = document.documentElement;
                this.init();
            }

            init() {
                const savedTheme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

                if (savedTheme) {
                    this.setTheme(savedTheme);
                } else if (systemPrefersDark) {
                    this.setTheme('dark');
                }

                this.themeToggle.addEventListener('click', () => this.toggleTheme());

                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (!localStorage.getItem('theme')) {
                        this.setTheme(e.matches ? 'dark' : 'light');
                    }
                });
            }

            setTheme(theme) {
                this.htmlElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                this.themeToggle.setAttribute('aria-label', 
                    theme === 'dark' ? '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É' : '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É');
            }

            toggleTheme() {
                const currentTheme = this.htmlElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(newTheme);

                this.themeToggle.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.themeToggle.style.transform = 'scale(1)';
                }, 150);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            new ThemeManager();
            new ProfileManager();
            
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.3s ease-in-out';
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã -->
<script src="auth-core.js"></script>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–µ–¥–µ—Ä–æ–º -->
<script src="auth-header.js"></script>
</body>
</html>